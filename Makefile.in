all:
	@make -C src libgrew.cmxa
	@make -C src libgrew.cma

LIB_DEP = libgrew_types.cmi libgrew.cmi libgrew.cma libgrew.cmxa libgrew.a

uninstall:
	$(OCAMLFIND) remove libgrew > /dev/null

uninstall_dev:
	$(OCAMLFIND) remove libgrew_dev > /dev/null


install: uninstall
	cp META META_
	sed -itmp "s|@VERSION@|$(VERSION)|g" META
	sed -itmp "s|@DEV@||g" META
	rm -rf METAtmp
	mkdir -p $(DESTDIR)$(DATA_DIR)/
	cp data/style.css $(DESTDIR)$(DATA_DIR)/
	cd src && $(OCAMLFIND) install libgrew ../META $(LIB_DEP)
	mv META_ META

install_dev: uninstall_dev
	cp META META_
	sed -itmp "s|@VERSION@|$(VERSION)|g" META
	sed -itmp "s|@DEV@|_dev|g" META
	rm -rf METAtmp
	cd src && $(OCAMLFIND) install libgrew_dev ../META $(LIB_DEP)
	mv META_ META
	cp data/style.css $(DESTDIR)$(DATA_DIR)/

conf: config/configure.ac
	cd config && rm -rf ac_lib_checking.*
	cd config && wget https://gforge.inria.fr/scm/viewvc.php/*checkout*/ac_lib_checking/ac_lib_checking.m4?root=semagramme  --no-check-certificate || true
	cd config && mv ac_lib_checking.m4?root=semagramme ac_lib_checking.m4 || true
	cd config && aclocal
	cd config && autoconf -o ../configure configure.ac
	rm -rf config.status config.log autom4te.cache config/autom4te.cache config/ac_lib_checking.m4

clean:
	@make -C src clean
	@make -C src/parser clean
	rm -f config.log confdefs.h config.status

purge: clean
	rm -f config/Makefile
	rm -f config/ac_lib_checking.m4
	rm -f Makefile src/Makefile test/Makefile
	rm -rf doc

.PHONY: doc
doc:
	@make -C src doc

include config/Makefile
