

all:
	@make -C src libgrew.cmxa
	@make -C src libgrew.cma


include config/Makefile

conf: config/configure.ac
	cd config && rm -rf ac_lib_checking.*
	cd config && wget https://gforge.inria.fr/scm/viewvc.php/*checkout*/ac_lib_checking/ac_lib_checking.m4?root=semagramme  --no-check-certificate || true
	cd config && mv ac_lib_checking.m4?root=semagramme ac_lib_checking.m4 || true
	cd config && aclocal
	cd config && autoconf -o ../configure configure.ac
	rm -rf config.status config.log autom4te.cache config/autom4te.cache config/ac_lib_checking.m4

purge_makefile:
	@make -C src purge_makefile
	@make purge
	@make -C config purge

clean:
	@make -C src clean
	@make cleanup

uninstall:
	$(OCAMLFIND) remove libgrew > /dev/null

uninstall_dev:
	$(OCAMLFIND) remove libgrew_dev > /dev/null

LIB_DEP = libgrew.cma libgrew.cmxa libgrew.a libgrew.cmi

install: uninstall
	cp META META_
	sed -itmp "s|@VERSION@|$(VERSION)|g" META
	sed -itmp "s|@DEV@||g" META
	rm -rf METAtmp
	mkdir -p $(DESTDIR)$(DATA_DIR)/
	cp data/style.css $(DESTDIR)$(DATA_DIR)/
	cd src && $(OCAMLFIND) install libgrew ../META $(LIB_DEP)
	mv META_ META

install_dev: uninstall_dev
	cp META META_
	sed -itmp "s|@VERSION@|$(VERSION)|g" META
	sed -itmp "s|@DEV@|_dev|g" META
	rm -rf METAtmp
	cd src && $(OCAMLFIND) install libgrew_dev ../META $(LIB_DEP)
	mv META_ META
	cp data/style.css $(DESTDIR)$(DATA_DIR)/


.PHONY: doc

doc:
	@make -C src doc
