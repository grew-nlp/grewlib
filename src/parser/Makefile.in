all: parser_global.cmx gr_grs_parser.cmx lexer.cmx grew_parser.cmx

byte: parser_global.cmo gr_grs_parser.cmo lexer.cmo grew_parser.cmo

include ../../config/Makefile

parser_global.cmo: parser_global.ml
	$(OCAMLC) -c $(BYTE_FLAGS) parser_global.ml

parser_global.cmx: parser_global.ml
	$(OCAMLOPT) -c $(OPT_FLAGS) parser_global.ml

gr_grs_parser.ml: gr_grs_parser.mly
	menhir --infer --ocamlc "ocamlc -c -I .. libgrew_utils.cmo grew_ast.cmo parser_global.cmo"  gr_grs_parser.mly

gr_grs_parser.cmx: gr_grs_parser.ml ../libgrew_utils.cmx ../grew_ast.cmx parser_global.cmo
	$(OCAMLOPT) -c $(OPT_FLAGS) -I .. libgrew_utils.cmx grew_ast.cmx gr_grs_parser.mli
	$(OCAMLOPT) -c $(OPT_FLAGS) -I .. libgrew_utils.cmx grew_ast.cmx gr_grs_parser.ml

gr_grs_parser.cmo: gr_grs_parser.ml ../libgrew_utils.cmo ../grew_ast.cmx parser_global.cmo
	$(OCAMLC) -c $(BYTE_FLAGS) -I .. libgrew_utils.cmo grew_ast.cmo gr_grs_parser.mli
	$(OCAMLC) -c $(BYTE_FLAGS) -I .. libgrew_utils.cmo grew_ast.cmo gr_grs_parser.ml

lexer.ml: lexer.mll
	ocamllex lexer.mll

lexer.cmx: gr_grs_parser.cmx lexer.ml ../grew_ast.cmx
	$(OCAMLOPT) -c $(OPT_FLAGS) -I .. grew_ast.cmx lexer.ml

lexer.cmo: gr_grs_parser.cmo lexer.ml ../grew_ast.cmo
	$(OCAMLC) -c $(BYTE_FLAGS) -I .. grew_ast.cmo lexer.ml

grew_parser.cmx: gr_grs_parser.cmx lexer.cmx grew_parser.ml ../grew_ast.cmx
	$(OCAMLOPT) -c $(OPT_FLAGS) -I .. grew_ast.cmx grew_parser.ml

grew_parser.cmo: gr_grs_parser.cmo lexer.cmo grew_parser.ml ../grew_ast.cmo
	$(OCAMLC) -c $(BYTE_FLAGS) -I .. grew_ast.cmo grew_parser.ml

clean:
	rm -rf *.cmi *.cmx *.cmo lexer.ml gr_grs_parser.ml *.o *.mli *.annot
